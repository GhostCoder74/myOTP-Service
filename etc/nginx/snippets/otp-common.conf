# Security und Header
add_header X-Frame-Options "SAMEORIGIN";
add_header X-Content-Type-Options "nosniff";
add_header Referrer-Policy "strict-origin-when-cross-origin";
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload";

# --- STATIC FILES ---
# z. B. CSS, QR-Codes, Icons
location /static/ {
    alias /opt/otp-service/static/;
    autoindex off;
    expires 1h;
    add_header Cache-Control "public";

    # Optional: Checking access rights
    # allow 127.0.0.1;
    # deny all;
}

location /static/qrcodes/ {
    alias /opt/otp-service/static/qrcodes/;
    autoindex on;                    # Verzeichnisauflistung erlauben
    autoindex_exact_size off;        # human-readable sizes
    autoindex_localtime on;          # local time
    add_header Cache-Control "no-store";
}

# --- MAIN FASTAPI APP ---
location / {
    proxy_pass http://127.0.0.1:38233;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;

    # WebSocket-Support (z. B. f√ºr FastAPI Admin oder Live-Reload)
    proxy_http_version 1.1;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection "upgrade";

    # Increase timeout for larger responses
    proxy_read_timeout 90;
}

